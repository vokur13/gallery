import { galleryItems } from './gallery-items.js';
// Change code below this line

const container = document.querySelector('.gallery');
const pictureMap = createPictureGalleryMarkup(galleryItems);
const modal = document.querySelector('.js-lightbox');
const modalImg = modal.querySelector('.lightbox__image');

let activeIndex = null;

// console.log(galleryItems);

container.addEventListener('click', onContainerClick);
container.insertAdjacentHTML('beforeend', pictureMap);
modal.addEventListener('click', modalClose);

function createPictureGalleryMarkup(gallery) {
  return gallery
    .map(({ preview, original, description }) => {
      return `<div class="gallery__item">
        <a class="gallery__link" href="${original}">
        <img 
        loading="lazy"
        class="gallery__image lazyload"
        src="${original}"
        alt="${description}"
        />
        </a>
        </div>`;
    })
    .join('');
}

function onContainerClick(e) {
  e.preventDefault();

  if (e.target.classList.contains('gallery__image')) {
    window.addEventListener('keydown', onKeyDown);
    modal.classList.add('is-open');
    modalImg.src = e.target.src;
    galleryItems.forEach((element, index) => {
      if (element.original === e.target.src) {
        activeIndex = index;
      }
    });
  }
}

function modalClose(e) {
  if (!e.target.classList.contains('lightbox__image')) {
    window.removeEventListener('keydown', onKeyDown);
    modal.classList.remove('is-open');
    modalImg.src = '';
  }
}

function onKeyDown(e) {
  if (e.code === 'ArrowRight' && activeIndex < galleryItems.length - 1) {
    activeIndex += 1;
    modalImg.src = galleryItems[activeIndex].original;
    return;
  }
  if (e.code === 'ArrowLeft' && activeIndex > 0) {
    activeIndex -= 1;
    modalImg.src = galleryItems[activeIndex].original;
    return;
  }
  if (e.code === 'ArrowRight' && activeIndex === galleryItems.length - 1) {
    activeIndex = 0;
    modalImg.src = galleryItems[activeIndex].original;
    return;
  }
  if (e.code === 'ArrowLeft' && activeIndex === 0) {
    activeIndex = galleryItems.length - 1;
    modalImg.src = galleryItems[activeIndex].original;
    return;
  }
}
